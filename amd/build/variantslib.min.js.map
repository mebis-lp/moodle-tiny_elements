{"version":3,"file":"variantslib.min.js","sources":["../src/variantslib.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Variants helper for Elements plugin.\n *\n * @module      tiny_elements/variantslib\n * @copyright   2023 Marc Catal√† <reskit@gmail.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {\n    findById,\n    findByName\n} from './helper';\n\nlet variantPreferences = {};\nlet DATA = {};\n\nexport const setData = (data) => {\n    DATA = data;\n};\n\nexport const getVariantPreferences = () => {\n    return variantPreferences;\n};\n\n/**\n * Load user preferences.\n * @param {array} preferences\n * @returns {Promise}\n */\nexport const loadVariantPreferences = (preferences) => {\n    if (preferences !== undefined && preferences !== null) {\n        variantPreferences = preferences;\n    } else {\n        variantPreferences = {};\n    }\n};\n\n/**\n * Get variant preferences for a single component-flavor combination.\n * @param {*} component\n * @param {*} flavor\n * @returns\n */\nexport const getVariantPreference = (component, flavor = '') => {\n    let componentObj = findByName(DATA.getComponents(), component);\n    let flavorObj = findByName(DATA.getFlavors(), flavor);\n\n    if (componentObj === undefined) {\n        return [];\n    }\n\n    if (flavor == '' && !variantPreferences[componentObj.id]) {\n        return [];\n    }\n\n    if (flavor != '' && flavorObj === undefined) {\n        return [];\n    }\n\n    if (flavor != '' && !variantPreferences[componentObj.id + '-' + flavorObj.id]) {\n        return [];\n    }\n\n    if (flavor == '') {\n        return variantPreferences[componentObj.id];\n    } else {\n        return variantPreferences[componentObj.id + '-' + flavorObj.id];\n    }\n};\n\n/**\n * Returns whether a variant exists for a component.\n *\n * @param  {string} component Component name\n * @param  {string} variant   Variant name\n * @param {string} flavor Flavor name\n * @returns {bool}\n */\nexport const variantExists = (component, variant, flavor = '') => {\n    let variantObj = findByName(DATA.getVariants(), variant);\n    return getVariantPreference(component, flavor).indexOf(variantObj.id) !== -1;\n};\n\n/**\n * Returns each variant for a component as a CSS class.\n *\n * @param  {string} component Component name\n * @param {string} flavor Flavor name\n * @returns {Array}\n */\nexport const getVariantsClass = (component, flavor = '') => {\n    let variants = [];\n    getVariantPreference(component, flavor).forEach(variant => {\n        let variantObj = findById(DATA.getVariants(), variant);\n        if (variantObj !== undefined) {\n            variants.push((variantObj.c4lcompatibility ? 'c4l' : 'elements') + '-' + variantObj.name + '-variant');\n        }\n    });\n\n    return variants;\n};\n\n/**\n * Return all HTML variants for a component.\n *\n * @param  {string} component Component name\n * @returns {string}\n */\nexport const getVariantsHtml = (component) => {\n    let variantsHtml = '';\n    let variantObj = {};\n\n    let componentObj = findByName(DATA.getComponents(), component);\n    componentObj.variants.forEach(variant => {\n        variantObj = findByName(DATA.getVariants(), variant);\n        if (variantObj != undefined) {\n            variantsHtml += variantObj.content;\n        }\n    });\n\n    return variantsHtml;\n};\n\n/**\n * Return the HTML variant.\n *\n * @param  {string} variant Variant name\n * @returns {string}\n */\nexport const getVariantHtml = (variant) => {\n    let variantHtml = [];\n    let variantObj = {};\n\n    variantObj = findByName(DATA.getVariants(), variant);\n    if (variantObj != undefined) {\n        variantHtml = variantObj.html;\n    }\n    return variantHtml;\n};\n\n/**\n * Add a variant to variantPreferences\n *\n * @param  {string} component Component name\n * @param  {string} variant   Variant name\n * @param {string} flavor Flavor name\n */\nexport const addVariant = (component, variant, flavor = '') => {\n    let componentObj = findByName(DATA.getComponents(), component);\n    let variantObj = findByName(DATA.getVariants(), variant);\n    let flavorObj = findByName(DATA.getFlavors(), flavor);\n\n    if (flavor == '') {\n        if (!variantPreferences[componentObj.id]) {\n            variantPreferences[componentObj.id] = [];\n        }\n        if (!variantExists(component, variant)) {\n            variantPreferences[componentObj.id].push(variantObj.id);\n        }\n    } else {\n        if (!variantPreferences[componentObj.id + '-' + flavorObj.id]) {\n            variantPreferences[componentObj.id + '-' + flavorObj.id] = [];\n        }\n        if (!variantExists(component, variant, flavor)) {\n            variantPreferences[componentObj.id + '-' + flavorObj.id].push(variantObj.id);\n        }\n    }\n};\n\n/**\n * Remove a variant from variantPreferences\n *\n * @param  {string} component Component name\n * @param  {string} variant   Variant name\n * @param {string} flavor Flavor name\n */\nexport const removeVariant = (component, variant, flavor = '') => {\n    let componentObj = findByName(DATA.getComponents(), component);\n    let variantObj = findByName(DATA.getVariants(), variant);\n    let flavorObj = findByName(DATA.getFlavors(), flavor);\n\n    if (flavor != '') {\n        let index = variantPreferences[componentObj.id + '-' + flavorObj.id].indexOf(variantObj.id);\n        if (index !== -1) {\n            delete variantPreferences[componentObj.id + '-' + flavorObj.id][index];\n        }\n        if (variantPreferences[componentObj.id + '-' + flavorObj.id].length == 0) {\n            delete variantPreferences[componentObj.id + '-' + flavorObj.id];\n        }\n    } else {\n        let index = variantPreferences[componentObj.id].indexOf(variantObj.id);\n        if (index !== -1) {\n            delete variantPreferences[componentObj.id][index];\n        }\n        if (variantPreferences[componentObj.id].length == 0) {\n            delete variantPreferences[componentObj.id];\n        }\n    }\n};\n"],"names":["variantPreferences","DATA","data","preferences","getVariantPreference","component","flavor","componentObj","getComponents","flavorObj","getFlavors","undefined","id","variantExists","variant","variantObj","getVariants","indexOf","variants","forEach","push","c4lcompatibility","name","variantsHtml","content","variantHtml","html","index","length"],"mappings":";;;;;;;;IA4BIA,mBAAqB,GACrBC,KAAO,oBAEaC,OACpBD,KAAOC,qCAG0B,IAC1BF,mDAQ4BG,cAE/BH,mBADAG,MAAAA,YACqBA,YAEA,UAUhBC,qBAAuB,SAACC,eAAWC,8DAAS,GACjDC,cAAe,sBAAWN,KAAKO,gBAAiBH,WAChDI,WAAY,sBAAWR,KAAKS,aAAcJ,oBAEzBK,IAAjBJ,aACO,GAGG,IAAVD,QAAiBN,mBAAmBO,aAAaK,IAIvC,IAAVN,aAA8BK,IAAdF,UACT,GAGG,IAAVH,QAAiBN,mBAAmBO,aAAaK,GAAK,IAAMH,UAAUG,IAI5D,IAAVN,OACON,mBAAmBO,aAAaK,IAEhCZ,mBAAmBO,aAAaK,GAAK,IAAMH,UAAUG,IANrD,GARA,6DA0BFC,cAAgB,SAACR,UAAWS,aAASR,8DAAS,GACnDS,YAAa,sBAAWd,KAAKe,cAAeF,gBAC2B,IAApEV,qBAAqBC,UAAWC,QAAQW,QAAQF,WAAWH,oEAUtC,SAACP,eAAWC,8DAAS,GAC7CY,SAAW,UACfd,qBAAqBC,UAAWC,QAAQa,SAAQL,cACxCC,YAAa,oBAASd,KAAKe,cAAeF,cAC3BH,IAAfI,YACAG,SAASE,MAAML,WAAWM,iBAAmB,MAAQ,YAAc,IAAMN,WAAWO,KAAO,eAI5FJ,mCASqBb,gBACxBkB,aAAe,GACfR,WAAa,UAEE,sBAAWd,KAAKO,gBAAiBH,WACvCa,SAASC,SAAQL,UAC1BC,YAAa,sBAAWd,KAAKe,cAAeF,SAC1BH,MAAdI,aACAQ,cAAgBR,WAAWS,YAI5BD,sCASoBT,cACvBW,YAAc,GACdV,WAAa,UAEjBA,YAAa,sBAAWd,KAAKe,cAAeF,SAC1BH,MAAdI,aACAU,YAAcV,WAAWW,MAEtBD,iCAUe,SAACpB,UAAWS,aAASR,8DAAS,GAChDC,cAAe,sBAAWN,KAAKO,gBAAiBH,WAChDU,YAAa,sBAAWd,KAAKe,cAAeF,SAC5CL,WAAY,sBAAWR,KAAKS,aAAcJ,QAEhC,IAAVA,QACKN,mBAAmBO,aAAaK,MACjCZ,mBAAmBO,aAAaK,IAAM,IAErCC,cAAcR,UAAWS,UAC1Bd,mBAAmBO,aAAaK,IAAIQ,KAAKL,WAAWH,MAGnDZ,mBAAmBO,aAAaK,GAAK,IAAMH,UAAUG,MACtDZ,mBAAmBO,aAAaK,GAAK,IAAMH,UAAUG,IAAM,IAE1DC,cAAcR,UAAWS,QAASR,SACnCN,mBAAmBO,aAAaK,GAAK,IAAMH,UAAUG,IAAIQ,KAAKL,WAAWH,6BAYxD,SAACP,UAAWS,aAASR,8DAAS,GACnDC,cAAe,sBAAWN,KAAKO,gBAAiBH,WAChDU,YAAa,sBAAWd,KAAKe,cAAeF,SAC5CL,WAAY,sBAAWR,KAAKS,aAAcJ,WAEhC,IAAVA,OAAc,KACVqB,MAAQ3B,mBAAmBO,aAAaK,GAAK,IAAMH,UAAUG,IAAIK,QAAQF,WAAWH,KACzE,IAAXe,cACO3B,mBAAmBO,aAAaK,GAAK,IAAMH,UAAUG,IAAIe,OAEG,GAAnE3B,mBAAmBO,aAAaK,GAAK,IAAMH,UAAUG,IAAIgB,eAClD5B,mBAAmBO,aAAaK,GAAK,IAAMH,UAAUG,QAE7D,KACCe,MAAQ3B,mBAAmBO,aAAaK,IAAIK,QAAQF,WAAWH,KACpD,IAAXe,cACO3B,mBAAmBO,aAAaK,IAAIe,OAEG,GAA9C3B,mBAAmBO,aAAaK,IAAIgB,eAC7B5B,mBAAmBO,aAAaK"}